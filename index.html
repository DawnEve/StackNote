<html>

<head>
	<meta http-equiv=Content-Type content="text/html;charset=utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

	<script src="/static/js/lib/vue.global-3.0.11.js"></script>
	<script src="/static/js/lib/vue-router.global-4.0.6.js"></script>
	<script src="/static/js/lib/axios.min-0.18.0.js"></script>

	<script src="/static/js/lib/marked-2.0.3.js"></script>


	<script src="/static/js/my-main.js"></script>
	
	<link rel="stylesheet" type="text/css" href="/static/css/index.css">
	<title>StackNote v0.1 | 学术笔记流水账 </title>
</head>



<body>
<div id="app1">
	<header>
		<ul id=topNav>
			<b class=logo><a href="/">StackNote</a></b>
			<template v-for="menu in topMenu">
				<li :class="{current: menu.path == currentRoute}">
					<router-link :to="menu.path">{{menu.caption}}</router-link>
				</li>
			</template>

			<!--
			<li class='out'><a target="_blank" href="https://github.com/DawnEve/StackNote">GitHub</a></li>
			-->
		</ul>
	</header>



	<main id="container">
		<!--
		<nav>1nav...</nav>
		<article>2article...</article>
		<aside>3aside...</aside>
		-->
		
		<router-view></router-view>
		    

	</main>
</div>






    <footer class="footer">
    	<p><i>种一棵树最好的时间是十年前，其次是现在。</i></p>
    	<p>"The best time to plant a tree was 20 years ago. The second best time is now."</p>
    	<p>Copyright &copy;2021 - present 
    		<a target="_blank" href="https://www.biomooc.com">biomooc.com</a>. 
    		All Rights Reserved.
    	</p>
    	<p>
    		<a href="/#/about">Contact me</a>. | 
    		Fork me at <a target="_blank" href="https://github.com/DawnEve/StackNote">GitHub</a>. 
    	</p>
    </footer>






<div id="gotoTop" title="Goto top">↑</div>





<script type="module">
var log=console.log;



// 共享数据部分
var app=Vue.createApp({
    data(){
        return {
        	timestamp: new Date().getTime(), //vm.timestamp

            //顶部目录
            topMenu:[
            	{path:'/', caption:'Home'},
            	{path:'/archive', caption:'Archive'},
            	{path:'/tags', caption:'Tags'},
            	{path:'/about', caption:'About'},
            ],

            // 博客分类
            categories: {1:"文献", 2:"英语", 3:"代码", 4:"杂谈" },
            posts: {value:''},

            // cate 和 tag 计数字典
            tagdict:{},
            catdict:{},

            //博客的年份
            years:[],
        }
    },

    computed:{
    	currentRoute(){
    		return this.$route.path;
    	},
    },


	methods:{
    	getPostList(){
    		var self=this;
			axios.get('/data/api/posts', {} ).then(function(res){
				var posts=eval(res.data);
				for(var i=0; i<posts.length;i++){
					var post=posts[i];
					// 计算属性
					post.url='/post/'+post.year+"/"+post.title;
					post.date=post.title.substring(0,2) +'-' + post.title.substring(2,4)
					post.time=post.year +'-'+ post.date;

					// 分类 的文章数
					var cat=post.category;
					if(cat in self.catdict){
						self.catdict[cat] +=1;
					}else{
						self.catdict[cat]=1;
					}


					// 标签云
					for(var j=0; j<post.tags.length; j++){
						var tag=post.tags[j];
						if(tag in self.tagdict){
							self.tagdict[tag] +=1;
						}else{
							self.tagdict[tag]=1;
						}
					}

					//年份
					if( ! self.years.includes( post.year )){
						self.years.push(post.year);
					}


				}
				self.posts.value=posts;
			});
    	}
    },

    mounted(){
    	this.getPostList()
    },




    //给子组件提供数据 暂时无用
    provide(){
    	return{
    		"categories": this.categories,
    		"posts": this.posts,
    		'catdict': this.catdict,
    		'tagdict': this.tagdict,
    		'years': this.years,
    	};    	
    },
    
})

// 载入所有的页面视图 组件
import Home from "/src/views/Home.js" //首页 list
import Archive from "/src/views/Archive.js"
import Category from "/src/views/Category.js"
import Tags from "/src/views/Tags.js"

//const About = {template: '<div>About</div>',}
import About from "/src/views/About.js"
import MyPost from "/src/views/MyPost.js" // 单个 md



//路由表
const routes = [
  { path: '/', component: Home },
  { path: '/post/:postPath+', component: MyPost },


  { path: '/archive', component: Archive },
  { path: '/tags', component: Tags },
  { path: '/about', component: About },
  { path: '/tag/:tag', component: Tags },
  { path: '/category/:cate', component: Category },
]

// 路由
const router = VueRouter.createRouter({
	//mode: 'history',
  history: VueRouter.createWebHashHistory(), 
  routes,
})

app.use(router)
var vm=app.mount("#app1");
window.vm=vm

</script>
</body>
</html>